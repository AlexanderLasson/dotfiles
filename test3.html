<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CACI • Pluto — Minimal Prompt</title>
  <meta name="description" content="Minimal, plug‑and‑play Pluto prompt UI. HTMX + Tailwind. Easy to wire to a local LLM or OpenWebUI." />

  <!-- Tailwind via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            ink: { 50:'#fafafa',100:'#f4f4f5',200:'#e4e4e7',300:'#d4d4d8',400:'#a1a1aa',500:'#71717a',600:'#52525b',700:'#3f3f46',800:'#18181b',900:'#0a0a0b' },
            brand: { 50:'#ffecec',100:'#ffd9d9',200:'#ffb3b3',300:'#ff8c8c',400:'#f26363',500:'#d71920',600:'#c1161c',700:'#9d1217',800:'#7a0e12',900:'#560a0d' }
          }
        }
      }
    }
  </script>

  <!-- HTMX -->
  <script src="https://unpkg.com/htmx.org@1.9.12"></script>

  <style>
    html { scroll-behavior: smooth; }
  </style>
</head>
<body class="bg-ink-50 text-ink-900">
  <!-- Header -->
  <header class="border-b border-ink-200 bg-white">
    <div class="max-w-5xl mx-auto h-14 px-3 flex items-center justify-between">
      <div class="flex items-center gap-2 font-semibold">
        <!-- Simple Pluto mark (kept tiny to minimize bloat) -->
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-5 h-5">
          <defs>
            <radialGradient id="pluto" cx="40%" cy="35%" r="70%">
              <stop offset="0%" stop-color="#fff5f5"/>
              <stop offset="55%" stop-color="#f7c9c9"/>
              <stop offset="100%" stop-color="#d71920"/>
            </radialGradient>
          </defs>
          <circle cx="12" cy="12" r="10" fill="url(#pluto)" stroke="#111" stroke-width=".5"/>
        </svg>
        <span>CACI • Pluto</span>
      </div>
      <div class="flex items-center gap-2 text-xs">
        <label class="flex items-center gap-1"><input type="checkbox" id="citations" checked> Citations</label>
        <label class="flex items-center gap-1"><input type="checkbox" id="rbac" checked> RBAC</label>
      </div>
    </div>
  </header>

  <!-- Chat -->
  <main class="max-w-3xl mx-auto px-3 py-4">
    <!-- System status / small helpers -->
    <div id="status" class="mb-3 text-xs text-ink-600 flex items-center justify-between">
      <div>Model: <span id="modelName" class="font-medium">local-llm</span></div>
      <div class="flex gap-2">
        <button id="btnProfile" class="px-2 py-1 rounded-lg border border-ink-200 text-xs">Prompt Profile</button>
        <button id="btnNew" class="px-2 py-1 rounded-lg bg-ink-900 text-white text-xs">New Chat</button>
      </div>
    </div>

    <!-- Messages -->
    <div id="messages" class="space-y-3">
      <!-- Example seed messages (safe to remove) -->
      <div class="flex gap-2">
        <div class="w-7 h-7 rounded-full bg-ink-900 text-white grid place-content-center text-xs">U</div>
        <div class="max-w-[85%] rounded-2xl rounded-tl-sm bg-ink-100 p-3 text-sm">Summarize failures linked to blah blah and draft Jira tickets.</div>
      </div>
      <div class="flex gap-2 justify-end">
        <div class="max-w-[85%] rounded-2xl rounded-tr-sm bg-brand-50 p-3 border border-brand-100 text-sm">
          Found 12 records in <b>testsuite_results</b>. Critical: physics mismatch, null telemetry packets, CI import failures. Drafted tickets for Unity + Backend.
          <div class="mt-2 text-[11px] text-ink-600">Citations: Jira PLUTO‑214 • GitLab MR#63 • Postgres rows #1021‑1032</div>
        </div>
        <div class="w-7 h-7 rounded-full bg-brand-600 text-white grid place-content-center text-xs">AI</div>
      </div>
    </div>

    <!-- Composer -->
    <form id="composer" class="mt-4 sticky bottom-3 bg-white/90 backdrop-blur rounded-2xl border border-ink-200 p-2 flex items-end gap-2"
          hx-post="/pluto/chat/" hx-target="#messages" hx-swap="beforeend">
      <!--
        Integration note:
        - Point hx-post to your chat endpoint (Django, FastAPI, or OpenWebUI proxy).
        - The endpoint should return an HTML fragment for a single AI message bubble like:
          <div class="flex gap-2 justify-end"> ... </div>
        - If you prefer JSON, return { html: "..." } and unwrap server-side.
      -->
      <textarea name="q" rows="1" placeholder="Ask Pluto… (Shift+Enter for newline)"
                class="flex-1 resize-none rounded-xl border border-ink-200 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-brand-300"></textarea>
      <button type="submit" class="px-3 py-2 rounded-xl bg-brand-600 text-white hover:bg-brand-700">Send</button>
    </form>

    <!-- Simple prompt profile modal (minimal markup) -->
    <dialog id="profileDialog" class="rounded-2xl p-0 w-[min(640px,92vw)]">
      <form method="dialog" class="border border-ink-200 rounded-2xl overflow-hidden">
        <div class="px-4 py-3 bg-ink-50 border-b border-ink-100 flex items-center justify-between">
          <div class="font-semibold text-sm">Prompt Profile</div>
          <button value="cancel" class="text-xs px-2 py-1 rounded-lg border border-ink-200">Close</button>
        </div>
        <div class="p-4 space-y-3 text-sm">
          <label class="block">System Prompt
            <textarea id="systemPrompt" rows="5" class="mt-1 w-full rounded-xl border border-ink-200 px-3 py-2">You are Pluto, a CACI internal assistant. Cite sources (record IDs), enforce RBAC, avoid external PII.</textarea>
          </label>
          <label class="block">Redaction Rules
            <textarea id="redaction" rows="4" class="mt-1 w-full rounded-xl border border-ink-200 px-3 py-2">Mask emails, phone numbers, contractor IDs. Only UNCLASS/CUI permitted to requester.</textarea>
          </label>
        </div>
        <div class="px-4 py-3 bg-ink-50 border-t border-ink-100 flex items-center justify-end gap-2">
          <button value="cancel" class="px-3 py-1.5 rounded-lg border border-ink-200">Cancel</button>
          <button id="saveProfile" value="default" class="px-3 py-1.5 rounded-lg bg-brand-600 text-white">Save</button>
        </div>
      </form>
    </dialog>

  </main>

  <script>
    // ---- Minimal UX helpers (no dependencies) ----
    const ta = document.querySelector('#composer textarea');
    function autosize(e){ e.target.style.height = 'auto'; e.target.style.height = e.target.scrollHeight + 'px'; }
    if (ta){ ta.addEventListener('input', autosize); }

    // Submit on Enter (but Shift+Enter = newline)
    ta && ta.addEventListener('keydown', (e)=>{ if(e.key==='Enter' && !e.shiftKey){ e.preventDefault(); e.target.form.requestSubmit(); }});

    // Open/close profile dialog
    const dialog = document.getElementById('profileDialog');
    document.getElementById('btnProfile').addEventListener('click', ()=> dialog.showModal());

    // Persist profile (demo only): POST to /pluto/prompt-profile/
    document.getElementById('saveProfile').addEventListener('click', (e)=>{
      e.preventDefault();
      const body = new FormData();
      body.append('system', document.getElementById('systemPrompt').value);
      body.append('redaction', document.getElementById('redaction').value);
      fetch('/pluto/prompt-profile/', { method:'POST', body })
        .catch(()=>{})
        .finally(()=> dialog.close());
    });

    // Example: flip model label when using OpenWebUI proxy
    // document.getElementById('modelName').textContent = 'openwebui-proxy (llama3.1)';
  </script>

  <!--
    Backend expectations (simple):
    1) POST /pluto/chat/
       - form field: q (string)
       - optional: citations (bool), rbac (bool) — use document.getElementById('citations').checked, etc.
       - return: HTML fragment for ONE AI message bubble, e.g.
         <div class="flex gap-2 justify-end">\n  <div class="max-w-[85%] rounded-2xl rounded-tr-sm bg-brand-50 p-3 border border-brand-100 text-sm">Answer...<div class="mt-2 text-[11px] text-ink-600">Citations...</div></div>\n  <div class="w-7 h-7 rounded-full bg-brand-600 text-white grid place-content-center text-xs">AI</div>\n</div>

    2) POST /pluto/prompt-profile/
       - form fields: system, redaction
       - persist to DB; no particular response body required

    3) OpenWebUI integration idea
       - Proxy /pluto/chat/ -> OpenWebUI API (send prompt + system), then format returned text into the HTML bubble above.
  -->
</body>
</html>
