<!doctype html
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CACI • Pluto — Chat + CMS</title>
  <meta name="description" content="Pluto is CACI's modern CMS platform with an AI assistant. Roadmap on top with hover details, a concise summary, and a slim ChatGPT-style prompt — all above the fold." />

  <!-- Tailwind (Play CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            caci: { red: '#D71920', black: '#0b0b0b', surface: '#111214' }
          },
          boxShadow: {
            soft: '0 10px 30px -10px rgba(0,0,0,0.25)'
          },
          fontFamily: {
            sans: ["Inter","ui-sans-serif","system-ui","-apple-system","Segoe UI","Roboto","Helvetica Neue","Arial","Noto Sans"]
          }
        }
      }
    }
  </script>

  <!-- HTMX -->
  <script src="https://unpkg.com/htmx.org@1.9.12"></script>

  <script>
    // Dark-mode persistence
    const themeKey='pluto-theme';
    function applyStoredTheme(){
      const s=localStorage.getItem(themeKey);
      if(s==='dark'||(!s&&matchMedia('(prefers-color-scheme: dark)').matches)){
        document.documentElement.classList.add('dark')
      }else{
        document.documentElement.classList.remove('dark')
      }
    }
    function toggleTheme(){
      const d=document.documentElement.classList.toggle('dark');
      localStorage.setItem(themeKey,d?'dark':'light')
    }
    applyStoredTheme();
  </script>

  <style>
    .thin-scroll::-webkit-scrollbar{width:8px;height:8px}
    .thin-scroll::-webkit-scrollbar-thumb{background:#c2c2c2;border-radius:4px}
    .dark .thin-scroll::-webkit-scrollbar-thumb{background:#3a3a3a}
    /* Roadmap tooltip caret positions (toggled by JS) */
    #rm-caret.rm-caret-top  { bottom: -6px; }
    #rm-caret.rm-caret-bot  { top: -6px;  }
    :root { font-size: 17px; }                /* ~106% */
    @media (min-width: 640px){ :root { font-size: 18px; } }  /* ~112% */
    @media (min-width: 1024px){ :root { font-size: 19px; } } /* ~119% */
  </style>
</head>
<body class="bg-white text-gray-800 dark:bg-caci-surface dark:text-gray-100 font-sans antialiased">
  <!-- Minimal Top bar -->
  <header class="sticky top-0 z-30 backdrop-blur bg-white/70 dark:bg-caci-surface/70 border-b border-gray-200 dark:border-white/10">
    <div class="mx-auto max-w-6xl px-4 sm:px-6 lg:px-8 h-12 flex items-center justify-between">
      <div class="flex items-center gap-2">
        <div class="h-6 w-6 rounded-md bg-caci-red"></div>
        <div class="text-sm font-semibold tracking-tight">CACI • Pluto</div>
      </div>
    <div class="flex items-center gap-2">
      <button onclick="toggleTheme()" 
        class="rounded-lg border border-gray-200 dark:border-white/10 px-2.5 py-1 text-xs hover:bg-gray-50 dark:hover:bg-white/5">
        Theme
      </button>
      <a href="/admin" 
        class="rounded-lg border border-gray-200 dark:border-white/10 px-2.5 py-1 text-xs hover:bg-gray-50 dark:hover:bg-white/5">
        Admin
      </a>
    </div>
    </div>
  </header>

  <!-- ===== LANDING (all above the fold) ===== -->
  <main class="mx-auto max-w-6xl px-4 sm:px-6 lg:px-8 pt-14 md:pt-16 pb-5 space-y-6 scroll-mt-24">
    <!-- ===== REDESIGNED ROADMAP ===== -->
    <section id="roadmap" class="rounded-2xl border border-gray-200 dark:border-white/10 bg-white dark:bg-black/30 p-4 shadow-soft">
      <div class="flex items-center justify-between mb-3">
        <h1 class="text-base font-bold">Pluto Roadmap</h1>
        <div class="flex items-center gap-3 text-[11px] text-gray-600 dark:text-gray-300">
          <span class="inline-flex items-center gap-1"><span class="h-2 w-2 rounded-full bg-caci-red"></span> Progress</span>
          <span class="inline-flex items-center gap-1"><span class="h-2 w-2 rounded-sm bg-gray-300 dark:bg-white/30"></span> Planned</span>
        </div>
      </div>

      <!-- Compact track with progress -->
      <div id="rm-wrap" class="relative">
        <div class="w-full h-3 rounded-full bg-gray-200/70 dark:bg-white/10"></div>
        <div id="rm-progress" class="absolute inset-y-0 left-0 bg-gradient-to-r from-caci-red to-caci-red/70 rounded-full" style="width:28%; pointer-events:none"></div>

        <!-- Tooltip card (flip-aware, pinnable, with caret) -->
        <div id="rm-card"
             class="hidden absolute z-50 w-[min(380px,92vw)] rounded-xl border border-gray-200 dark:border-white/10 bg-white dark:bg-black/85 text-gray-800 dark:text-gray-100 p-4 shadow-soft">
          <div class="text-sm font-semibold" id="rm-title"></div>
          <ul class="mt-2 space-y-1 text-xs" id="rm-items"></ul>
          <div class="mt-3 flex items-center justify-between">
            <span class="text-[11px] text-gray-500 dark:text-gray-400">Tip: Click a phase to pin</span>
            <button id="rm-unpin" class="hidden text-[11px] px-2 py-1 rounded border border-gray-200 dark:border-white/10 hover:bg-gray-50 dark:hover:bg-white/10">Unpin</button>
          </div>
          <span id="rm-caret" class="absolute block w-3 h-3 rotate-45 bg-white dark:bg-black/85 border border-gray-200 dark:border-white/10 border-t-0 border-l-0"></span>
        </div>
      </div>

      <!-- Big, targetable phase chips -->
      <div id="rm-segments" class="mt-4 grid grid-cols-1 sm:grid-cols-5 gap-2">
        <button class="rm-seg group relative rounded-xl border border-gray-200 dark:border-white/10 bg-white dark:bg-white/5 p-3 text-left transition hover:shadow-soft hover:-translate-y-0.5 focus:-translate-y-0.5 focus:shadow-soft outline-none"
                data-idx="0" aria-label="Phase 0 Prototype">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-2">
              <span class="inline-flex h-2.5 w-2.5 rounded-full bg-emerald-500"></span>
              <span class="text-[12px] font-semibold">P0 • Prototype</span>
            </div>
            <span class="text-[11px] text-gray-500 dark:text-gray-400">Done</span>
          </div>
          <div class="mt-2 h-1.5 w-full rounded bg-gray-100 dark:bg-white/10">
            <div class="h-1.5 rounded bg-emerald-500" style="width:100%"></div>
          </div>
          <span class="pointer-events-none absolute inset-0 rounded-xl ring-2 ring-transparent group-hover:ring-black/10 dark:group-hover:ring-white/20"></span>
        </button>

        <button class="rm-seg group relative rounded-xl border border-gray-200 dark:border-white/10 bg-white dark:bg-white/5 p-3 text-left transition hover:shadow-soft hover:-translate-y-0.5 focus:-translate-y-0.5 focus:shadow-soft outline-none"
                data-idx="1" aria-label="Phase 1 Data Ingest">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-2">
              <span class="inline-flex h-2.5 w-2.5 rounded-full bg-caci-red"></span>
              <span class="text-[12px] font-semibold">P1 • Data Ingest</span>
            </div>
            <span class="text-[11px] text-gray-500 dark:text-gray-400">In Progress</span>
          </div>
          <div class="mt-2 h-1.5 w-full rounded bg-gray-100 dark:bg-white/10">
            <div class="h-1.5 rounded bg-caci-red/80" style="width:40%"></div>
          </div>
          <span class="pointer-events-none absolute inset-0 rounded-xl ring-2 ring-transparent group-hover:ring-black/10 dark:group-hover:ring-white/20"></span>
        </button>

        <button class="rm-seg group relative rounded-xl border border-gray-200 dark:border-white/10 bg-white dark:bg-white/5 p-3 text-left transition hover:shadow-soft hover:-translate-y-0.5 focus:-translate-y-0.5 focus:shadow-soft outline-none"
                data-idx="2" aria-label="Phase 2 AI Assistant">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-2">
              <span class="inline-flex h-2.5 w-2.5 rounded-sm bg-gray-300 dark:bg-white/30"></span>
              <span class="text-[12px] font-semibold">P2 • AI Assistant</span>
            </div>
            <span class="text-[11px] text-gray-500 dark:text-gray-400">Planned</span>
          </div>
          <div class="mt-2 h-1.5 w-full rounded bg-gray-100 dark:bg-white/10"></div>
          <span class="pointer-events-none absolute inset-0 rounded-xl ring-2 ring-transparent group-hover:ring-black/10 dark:group-hover:ring-white/20"></span>
        </button>

        <button class="rm-seg group relative rounded-xl border border-gray-200 dark:border-white/10 bg-white dark:bg-white/5 p-3 text-left transition hover:shadow-soft hover:-translate-y-0.5 focus:-translate-y-0.5 focus:shadow-soft outline-none"
                data-idx="3" aria-label="Phase 3 Integrations">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-2">
              <span class="inline-flex h-2.5 w-2.5 rounded-sm bg-gray-300 dark:bg-white/30"></span>
              <span class="text-[12px] font-semibold">P3 • Integrations</span>
            </div>
            <span class="text-[11px] text-gray-500 dark:text-gray-400">Planned</span>
          </div>
          <div class="mt-2 h-1.5 w-full rounded bg-gray-100 dark:bg-white/10"></div>
          <span class="pointer-events-none absolute inset-0 rounded-xl ring-2 ring-transparent group-hover:ring-black/10 dark:group-hover:ring-white/20"></span>
        </button>

        <button class="rm-seg group relative rounded-xl border border-gray-200 dark:border-white/10 bg-white dark:bg-white/5 p-3 text-left transition hover:shadow-soft hover:-translate-y-0.5 focus:-translate-y-0.5 focus:shadow-soft outline-none"
                data-idx="4" aria-label="Phase 4 Enterprise">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-2">
              <span class="inline-flex h-2.5 w-2.5 rounded-sm bg-gray-300 dark:bg-white/30"></span>
              <span class="text-[12px] font-semibold">P4 • Enterprise</span>
            </div>
            <span class="text-[11px] text-gray-500 dark:text-gray-400">Planned</span>
          </div>
          <div class="mt-2 h-1.5 w-full rounded bg-gray-100 dark:bg-white/10"></div>
          <span class="pointer-events-none absolute inset-0 rounded-xl ring-2 ring-transparent group-hover:ring-black/10 dark:group-hover:ring-white/20"></span>
        </button>
      </div>

      <p class="mt-5 text-[11px] text-gray-500 dark:text-gray-400">Q4 2025 target • Hover or focus P0–P4 • Click to pin details</p>
    </section>

    <!-- ===== VISUAL SUMMARY ===== -->
    <section id="summary" class="rounded-2xl border border-gray-200 dark:border-white/10 bg-gradient-to-br from-white to-gray-50 dark:from-black/30 dark:to-black/10 p-5">
      <div class="flex items-start gap-4">
        <div class="h-9 w-9 rounded-xl bg-caci-red shadow-soft "></div>
        <div class="flex-1">
          <h2 class="text-lg font-bold">What is Pluto?</h2>
          <p class="mt-1 text-sm leading-6 text-gray-700 dark:text-gray-300">
            Pluto is CACI’s CMS + AI assistant for internal networks. A lightweight <span class="font-medium">HTMX</span> frontend and <span class="font-medium">Django + Postgres</span> backend connect to <span class="font-medium">OpenWebUI</span> for natural-language tasks—summaries, Jira links, and status drafts—under RBAC and auditing.
          </p>
          <div class="mt-3 grid grid-cols-2 sm:grid-cols-4 gap-2 text-[11px]">
            <div class="flex items-center gap-2 rounded-lg border border-gray-200 dark:border-white/10 px-2 py-1"><span class="i-check"></span> CMS + AI Chat</div>
            <div class="flex items-center gap-2 rounded-lg border border-gray-200 dark:border-white/10 px-2 py-1"><span class="i-check"></span> HTMX Simplicity</div>
            <div class="flex items-center gap-2 rounded-lg border border-gray-200 dark:border-white/10 px-2 py-1"><span class="i-check"></span> CACI Branding</div>
            <div class="flex items-center gap-2 rounded-lg border border-gray-200 dark:border-white/10 px-2 py-1"><span class="i-check"></span> Jira/GitLab Hooks</div>
          </div>
        </div>
      </div>
    </section>

    <!-- ===== PROMPT (slim, grows as needed) ===== -->
    <section id="prompt" class="rounded-2xl border border-gray-200 dark:border-white/10 bg-white dark:bg-black/30 p-4 shadow-soft">
      <div id="chat-viewport" class="thin-scroll overflow-y-auto hidden max-h-[55vh] p-0 space-y-3" aria-live="polite"></div>
      <form id="composer" class="mt-1 flex items-center gap-2"
            hx-post="/ai/prompt"
            hx-trigger="submit"
            hx-target="#chat-viewport"
            hx-swap="beforeend"
            hx-indicator="#thinking">
        <label for="prompt-input" class="sr-only">Your prompt</label>
        <textarea id="prompt-input" name="prompt" rows="1" required
          class="flex-1 rounded-xl border border-gray-200 dark:border-white/10 bg-white dark:bg-black/30 px-3 py-2 leading-5 text-sm focus:outline-none focus:ring-2 focus:ring-caci-red/50 resize-none min-h-[38px]"
          placeholder="Ask Pluto…"></textarea>
        <button type="submit" class="inline-flex items-center justify-center gap-2 rounded-xl bg-caci-red px-3 py-2 text-sm font-semibold text-white shadow-soft hover:opacity-95 h-[38px]">
          <svg class="h-4 w-4" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M2.01 21l20.99-9L2.01 3 2 10l15 2-15 2z"/></svg>
          Send
        </button>
      </form>
      <div id="thinking" class="htmx-indicator mt-1 text-[11px] text-gray-500 dark:text-gray-400">Thinking…</div>
      <p class="mt-1 text-[11px] text-gray-500 dark:text-gray-400">Command+Enter = send</p>
    </section>
  </main>

  <script>
    // Inline check icon SVGs for summary badges
    document.querySelectorAll('.i-check').forEach(n=>{
      n.innerHTML = '<svg viewBox="0 0 24 24" class="h-3.5 w-3.5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6L9 17l-5-5"/></svg>'
    });

    // ===== Redesigned Roadmap Logic (hover, flip, keyboard, pin) =====
    const rmData = [
      { title:'Phase 0 — Prototype',  status:'Done',        items:['Django project, Unfold admin','DRF endpoints (Unity telemetry)','Postgres baseline schema'] },
      { title:'Phase 1 — Data Ingest',status:'In Progress', items:['CSV import + validation','Jira integration (create/link issues)','Role-based access (RBAC)'] },
      { title:'Phase 2 — AI Assistant',status:'Planned',    items:['HTMX prompt → Django proxy','OpenWebUI connector','Guardrails, audit logs'] },
      { title:'Phase 3 — Integrations',status:'Planned',    items:['GitLab CI/CD webhooks','SSO (SAML/OIDC)','Observability (OpenTelemetry)'] },
      { title:'Phase 4 — Enterprise',  status:'Planned',    items:['Fine-grained permissions','Backups & retention','SLA & on-call playbooks'] }
    ];

    const wrap   = document.getElementById('rm-wrap');
    const card   = document.getElementById('rm-card');
    const title  = document.getElementById('rm-title');
    const items  = document.getElementById('rm-items');
    const caret  = document.getElementById('rm-caret');
    const unpin  = document.getElementById('rm-unpin');
    const segs   = Array.from(document.querySelectorAll('#rm-segments .rm-seg'));

    let pinnedIdx = null;
    const clamp = (v,min,max)=>Math.min(max,Math.max(min,v));

    function renderCardContent(idx){
      const d = rmData[idx];
      title.textContent = `${d.title} — ${d.status}`;
      items.innerHTML   = d.items.map(t=>`
        <li class="flex items-center gap-2">
          <svg viewBox="0 0 24 24" class="h-3.5 w-3.5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6L9 17l-5-5"/></svg>
          <span>${t}</span>
        </li>`).join('');
    }

    function positionCardFor(el){
      const segRect  = el.getBoundingClientRect();
      const wrapRect = wrap.getBoundingClientRect();
      const centerX  = segRect.left + segRect.width/2 - wrapRect.left;

      // Reveal to measure
      card.style.left = '0px';
      card.style.top  = '0px';
      card.classList.remove('hidden');

      requestAnimationFrame(()=>{
        const cardW = card.offsetWidth;
        const cardH = card.offsetHeight;

        const haveRoomAbove = (wrapRect.top - cardH - 14) > 0;
        const left = clamp(centerX - cardW/2, 8, wrapRect.width - cardW - 8);
        card.style.left = `${left}px`;

        // caret horizontal alignment to segment center (clamped to card)
        const caretOffset = clamp(centerX - left - 6, 10, cardW - 10);
        caret.style.left = `${caretOffset}px`;

        caret.classList.remove('rm-caret-top','rm-caret-bot');
        if (haveRoomAbove) {
          card.style.top = `-10px`;
          card.style.transform = `translateY(-100%)`;
          caret.classList.add('rm-caret-top');
        } else {
          card.style.top = `${wrapRect.height + 10}px`;
          card.style.transform = `translateY(0)`;
          caret.classList.add('rm-caret-bot');
        }
      });
    }

    function openCard(idx, el){
      renderCardContent(idx);
      positionCardFor(el);
      unpin.classList.toggle('hidden', pinnedIdx === null);
    }

    function handleHover(e){
      if (pinnedIdx !== null) return; // ignore hover when pinned
      const el  = e.currentTarget;
      const idx = +el.dataset.idx;
      openCard(idx, el);
    }
    function handleLeave(){
      if (pinnedIdx !== null) return;
      card.classList.add('hidden');
    }
    function handleClick(e){
      const el  = e.currentTarget;
      const idx = +el.dataset.idx;
      if (pinnedIdx === idx) {
        pinnedIdx = null;
        card.classList.add('hidden');
        unpin.classList.add('hidden');
      } else {
        pinnedIdx = idx;
        openCard(idx, el);
        unpin.classList.remove('hidden');
      }
    }
    function handleKeydown(e){
      const el  = e.currentTarget;
      const idx = +el.dataset.idx;
      if (['ArrowRight','ArrowLeft','Enter','Escape'].includes(e.key)) e.preventDefault();

      if (e.key === 'ArrowRight'){
        const next = segs[(idx+1) % segs.length];
        next.focus();
        if (pinnedIdx === null) openCard(+next.dataset.idx, next);
      }
      if (e.key === 'ArrowLeft'){
        const prev = segs[(idx-1+segs.length) % segs.length];
        prev.focus();
        if (pinnedIdx === null) openCard(+prev.dataset.idx, prev);
      }
      if (e.key === 'Enter'){
        handleClick(e);
      }
      if (e.key === 'Escape'){
        pinnedIdx = null;
        card.classList.add('hidden');
        unpin.classList.add('hidden');
      }
    }

    segs.forEach(el=>{
      el.addEventListener('mouseenter', handleHover);
      el.addEventListener('focus',     handleHover);
      el.addEventListener('mouseleave', handleLeave);
      el.addEventListener('blur',       handleLeave);
      el.addEventListener('click',      handleClick);
      el.addEventListener('keydown',    handleKeydown);
    });

    unpin.addEventListener('click', ()=>{
      pinnedIdx = null;
      card.classList.add('hidden');
      unpin.classList.add('hidden');
    });

    // Reposition on resize/scroll when pinned
    window.addEventListener('resize', ()=>{
      if (pinnedIdx !== null){
        const el = segs[pinnedIdx];
        openCard(pinnedIdx, el);
      }
    }, {passive:true});
    window.addEventListener('scroll', ()=>{
      if (pinnedIdx !== null){
        const el = segs[pinnedIdx];
        openCard(pinnedIdx, el);
      }
    }, {passive:true});

    // ===== Chat auto-grow + reveal viewport on first message =====
    const ta = document.getElementById('prompt-input');
    function autoResize(){ if(!ta) return; ta.style.height='auto'; ta.style.height=Math.min(160, ta.scrollHeight)+'px'; }
    ta?.addEventListener('input', autoResize);
    document.getElementById('composer')?.addEventListener('htmx:afterSwap', () => {
      const v = document.getElementById('chat-viewport');
      if(v.classList.contains('hidden')) v.classList.remove('hidden');
      if(!v.style.padding) v.style.padding = '0.75rem';
      v.scrollTop = v.scrollHeight; autoResize();
    });
    ta?.addEventListener('keydown', (e)=>{ if(e.key==='Enter' && !e.shiftKey){ e.preventDefault(); document.getElementById('composer').requestSubmit(); }});
  </script>
</body>
</html>
